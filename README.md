# Ansible Playbooks

Этот репозиторий содержит набор Ansible-плейбуков для развертывания и настройки виртуальных машин, включая инфраструктуру для Minecraft-серверов.

## Шаблоны виртуальных машин

### `template-101`
- **Описание**: Базовый образ с предустановленными версиями Java
- **Компоненты**:
  - OpenJDK (все основные версии)
  - Базовые утилиты для работы с Java-приложениями

### `template-102`
- **Описание**: Готовый образ с системами мониторинга
- **Компоненты**:
  - Prometheus (предварительно настроенный)
  - Grafana (с базовой конфигурацией)
  - Готовые настройки для интеграции с Minecraft-сервером

## Плейбуки

### `sample_1 - Create_vm`
- **Назначение**: Создание чистой виртуальной машины
- **Функционал**:
  - Развертывание VM на основе шаблона `template-101`
  - Клонирование указанного Git-репозитория
  - Базовая настройка окружения

### `sample_2 - Create_minecraft_vm`
- **Назначение**: Развертывание Minecraft-сервера
- **Функционал**:
  - Создание VM на основе `template-101`
  - Клонирование репозитория с сервером
  - Проверка наличия:
    - Файла `.jar` (основной сервер)
    - Папки `plugins` (для дополнений)
  - Запуск сервера в `tmux`-сессии
  - Настройка Nginx-прокси:
    - Проброс порта *** → 25565

### `sample_3 - Create_minecraft-vm-2`
- **Назначение**: Развертывание Minecraft-сервера с системой мониторинга
- **Функционал**:
  - **VM1** (на основе `template-101`):
    - Все функции из `sample_2`
    - Добавление плагина мониторинга в папку `plugins`
  - **VM2** (на основе `template-102`):
    - Настройка Grafana:
      - Добавление дашбордов
      - Конфигурация Prometheus
    - Интеграция с VM1 для сбора метрик

### `sample_4 - Create_minecraft_vm-3`
- **Назначение**: Расширенное развертывание с тестовым контуром
- **Функционал**:
  - Все функции из `sample_3`
  - Дополнительно:
    - **VM3**: Тестовый контур (аналогичный `sample_2`)
      - Клонирование того же репозитория
      - Проброс нового порта
    - Настройка системы бэкапов:
      - Запуск скрипта регулярного сохранения
      - Резервное копирование миров и конфигураций

### `sample_5 - Create_minecraft_vm-4`
- **Назначение**: Развертывание инфраструктуры с прокси-сервером для Minecraft
- **Функционал**:
  - Все функции из `sample_4` (3 виртуальные машины)
  - Дополнительно:
    - **VM4**: Прокси-сервер (на основе `template-101`)
      - Развертывание Velocity/BungeeCord:
        - Клонирование репозитория (аналогично `sample_2`)
        - Запуск `.jar`-файла прокси в `tmux`-сессии
        - **Отличие от `sample_2`**:
          - Пропуск проверки папки `plugins`
      - Настройка Nginx-прокси:
        - Проброс портов для прокси-сервера
  - Полная схема работы:
    ```mermaid
    graph LR
      A[Игроки] --> B[VM4: Прокси]
      B --> C[VM1: Основной сервер]
      B --> D[VM3: Тестовый сервер]
      C --> E[VM2: Мониторинг]
    ```
